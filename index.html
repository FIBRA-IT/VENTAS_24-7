<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IT Support | Fibra Inn</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  
  <style>
    /* --- ESTILOS FIBRA INN --- */
    :root {
      --verde-lima: #C4D600;
      --verde-oscuro: #0E2A27;
      --verde-medio: #113C35;
      --texto-claro: #F5F5F5;
      --texto-gris: #a0b3b0;
      --blanco: #FFFFFF;
      --error: #ff6b6b;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(135deg, var(--verde-oscuro) 0%, #05110f 100%);
      color: var(--texto-claro);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    h1, h2, h3 { font-family: 'Playfair Display', serif; letter-spacing: 0.5px; }
    .hidden { display: none !important; }
    
    /* LOGO */
    .logo-img {
      max-width: 140px;
      height: auto;
      border-radius: 8px;
      margin-bottom: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    /* CONTENEDOR PRINCIPAL */
    .container {
      background-color: rgba(17, 60, 53, 0.95);
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      width: 100%;
      max-width: 500px;
      border-top: 4px solid var(--verde-lima);
      animation: fadeIn 0.5s ease-in-out;
      position: relative;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    #support-view { max-width: 700px; }

    /* PESTAÑAS (TABS) */
    .nav-tabs {
      display: flex;
      margin-bottom: 25px;
      border-bottom: 1px solid #2a5c52;
    }
    .nav-tab {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: var(--texto-gris);
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .nav-tab:hover { color: var(--blanco); }
    .nav-tab.active {
      color: var(--verde-lima);
      border-bottom: 3px solid var(--verde-lima);
    }

    /* FORMULARIOS */
    .form-group { margin-bottom: 20px; text-align: left; }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--verde-lima);
      font-size: 0.9rem;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #2a5c52;
      background-color: rgba(255,255,255,0.05);
      border-radius: 6px;
      color: var(--blanco);
      font-family: 'Open Sans', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--verde-lima);
      background-color: rgba(255,255,255,0.1);
    }

    .btn {
      width: 100%;
      padding: 14px;
      background-color: var(--verde-lima);
      color: var(--verde-oscuro);
      border: none;
      border-radius: 6px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
      background-color: #dbeecf;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(196, 214, 0, 0.3);
    }

    .btn:disabled {
      background-color: #666;
      cursor: not-allowed;
      transform: none;
    }

    .error-msg { color: var(--error); font-size: 0.9rem; margin-top: 10px; text-align: center; display: none; }
    
    .header-bar {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; padding-bottom: 15px;
    }

    .logout-btn {
      background: transparent; border: 1px solid var(--verde-lima);
      color: var(--verde-lima); padding: 5px 15px;
      font-size: 0.8rem; border-radius: 4px; cursor: pointer;
    }
    .logout-btn:hover { background: var(--verde-lima); color: var(--verde-oscuro); }

    /* ESTATUS */
    .ticket-result {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid var(--verde-lima);
    }
    .status-badge {
      display: inline-block; padding: 4px 10px;
      border-radius: 4px; font-size: 0.85rem; font-weight: bold;
      margin-left: 10px; text-transform: uppercase;
    }
    .status-pendiente { background: #f39c12; color: #fff; }
    .status-proceso { background: #3498db; color: #fff; }
    .status-cerrado { background: var(--verde-lima); color: var(--verde-oscuro); }

    @media (max-width: 600px) {
      .container { padding: 20px; margin: 10px; width: 95%; }
      .nav-tab { padding: 8px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login-view" class="container">
    <img src="https://media.licdn.com/dms/image/v2/D560BAQHevH5LsJpmXQ/company-logo_200_200/B56Zi.DanDG4AI-/0/1755535223547/fibrainn_logo?e=2147483647&v=beta&t=IYGkfmXcHxEqXIvZ59Fyp20tYrYLykd70Ot_0YBIN1k" alt="Logo Fibra Inn" class="logo-img">
    <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.3rem;">Acceso Soporte IT</h2>
    
    <form id="loginForm">
      <div class="form-group">
        <label><i class="fa fa-user"></i> Usuario (Incode)</label>
        <input type="text" id="username" placeholder="Ej: CUUMX" style="text-transform: uppercase;" required>
      </div>
      <div class="form-group">
        <label><i class="fa fa-lock"></i> Contraseña</label>
        <input type="password" id="password" placeholder="••••" required>
      </div>
      <button type="submit" class="btn">Ingresar</button>
      <p class="error-msg" id="loginError">Usuario o contraseña incorrectos.</p>
    </form>
  </div>

  <!-- APLICACIÓN PRINCIPAL -->
  <div id="support-view" class="container hidden">
    <div class="header-bar">
      <div>
        <h2 style="margin:0; font-size:1.5rem;">Soporte IT</h2>
        <small id="userDisplay" style="color:var(--verde-lima); font-weight:600;"></small>
      </div>
      <button class="logout-btn" onclick="logout()">Salir</button>
    </div>

    <div class="nav-tabs">
      <button class="nav-tab active" id="tabBtn-report" onclick="switchTab('report')">Nuevo Reporte</button>
      <button class="nav-tab" id="tabBtn-status" onclick="switchTab('status')">Consultar Estatus</button>
    </div>

    <!-- SECCIÓN 1: LEVANTAR REPORTE -->
    <div id="tab-report">
      <!-- Mensaje de Éxito -->
      <div id="successMessage" class="hidden" style="text-align: center; padding: 20px;">
        <div style="font-size: 4rem; color: var(--verde-lima); margin-bottom: 15px;">
          <i class="fa fa-check-circle"></i>
        </div>
        <h3>¡Ticket Registrado!</h3>
        <p style="margin: 10px 0;">Tu ID de seguimiento es:</p>
        <div style="background: #fff; color: #000; padding: 10px; font-size: 1.4rem; font-weight: bold; border-radius: 6px; display: inline-block; margin-bottom: 15px;" id="newTicketId">
          ...
        </div>
        <p style="font-size:0.9rem; color:var(--texto-gris)">Se ha enviado una notificación al equipo de Sistemas.</p>
        <button class="btn" onclick="resetForm()" style="margin-top:20px">Nuevo Reporte</button>
      </div>

      <!-- Formulario -->
      <form id="ticketForm">
        <div class="form-group">
          <label>Incode del Hotel</label>
          <select id="incodeHotel" name="incode" required>
            <option value="" disabled selected>Cargando...</option>
            <option value="CUUMX">CUUMX - Chihuahua</option>
            <option value="CUUCY">CUUCY - Chihuahua</option>
            <option value="CUUDE">CUUDE - Chihuahua</option>
            <option value="CUUWY">CUUWY - Chihuahua</option>
            <option value="CJSAT">CJSAT - Ciudad Juárez</option>
            <option value="JUAZO">JUAZO - Ciudad Juárez</option>
            <option value="JUAMI">JUAMI - Ciudad Juárez</option>
          </select>
        </div>

        <div class="form-group">
          <label>Nombre de quien reporta</label>
          <input type="text" id="reporterName" name="nombre" placeholder="Nombre completo" required>
        </div>

        <div class="form-group">
          <label>Correo Electrónico (Fibra Inn)</label>
          <input type="email" id="reporterEmail" name="email" placeholder="usuario@fibrainn.mx" required>
        </div>

        <div class="form-group">
          <label>Descripción del Problema</label>
          <textarea id="problemDesc" name="problema" rows="4" placeholder="Describe la falla detalladamente..." required></textarea>
        </div>

        <!-- Campos ocultos -->
        <input type="hidden" id="hiddenDate" name="fecha">

        <button type="submit" class="btn" id="submitBtn">
          <i class="fa fa-paper-plane"></i> Enviar Ticket
        </button>
      </form>
    </div>

    <!-- SECCIÓN 2: CONSULTAR ESTATUS -->
    <div id="tab-status" class="hidden">
      <div class="form-group">
        <label>Ingrese ID del Ticket</label>
        <input type="text" id="searchTicketId" placeholder="Ej: TKT-4521">
      </div>
      <button class="btn" onclick="buscarTicket()" id="btnBuscar">
        <i class="fa fa-search"></i> Buscar Ticket
      </button>
      
      <div id="searchResult" class="hidden ticket-result">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h3 id="resId" style="color:var(--verde-lima); margin:0;"></h3>
          <span id="resStatus" class="status-badge"></span>
        </div>
        <p style="font-size:0.9rem; color:var(--texto-gris); margin-bottom:15px;" id="resDate"></p>
        
        <p><strong>Comentarios de Sistemas:</strong></p>
        <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:4px; min-height:60px; margin-top:5px;">
          <p id="resComments" style="font-style:italic; color:var(--texto-claro)">...</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ==============================================
       CONFIGURACIÓN
       ============================================== */
    // Tu enlace de Google Apps Script (El que proporcionaste)
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyXkJtXEWrYz5izdFpY4xoJwhDYDxrrSe1QA-G_A48FN7ksKDsgdWToh-t5c--HwOuqOA/exec';

    // Credenciales de Acceso
    const credentials = {
      "CUUMX": "1020", "CUUCY": "1115", "CUUWY": "4578", "CUUDE": "1623",
      "CJSAT": "1632", "JUAZO": "9865", "JUAMI": "7410"
    };

    /* ==============================================
       LÓGICA DE LOGIN
       ============================================== */
    const loginView = document.getElementById('login-view');
    const supportView = document.getElementById('support-view');
    const loginForm = document.getElementById('loginForm');

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const user = document.getElementById('username').value.trim().toUpperCase();
      const pass = document.getElementById('password').value.trim();

      if (credentials[user] && credentials[user] === pass) {
        loginView.classList.add('hidden');
        supportView.classList.remove('hidden');
        document.getElementById('incodeHotel').value = user;
        document.getElementById('userDisplay').innerText = "Usuario: " + user;
      } else {
        // Animación de error
        const errorMsg = document.getElementById('loginError');
        errorMsg.style.display = 'block';
        loginView.style.animation = 'none';
        setTimeout(() => loginView.style.animation = 'fadeIn 0.5s', 10);
      }
    });

    function logout() {
      loginForm.reset();
      supportView.classList.add('hidden');
      loginView.classList.remove('hidden');
      document.getElementById('loginError').style.display = 'none';
    }

    /* ==============================================
       NAVEGACIÓN (TABS)
       ============================================== */
    function switchTab(tab) {
      const tabReport = document.getElementById('tab-report');
      const tabStatus = document.getElementById('tab-status');
      const btnReport = document.getElementById('tabBtn-report');
      const btnStatus = document.getElementById('tabBtn-status');

      if(tab === 'report') {
        tabReport.classList.remove('hidden');
        tabStatus.classList.add('hidden');
        btnReport.classList.add('active');
        btnStatus.classList.remove('active');
      } else {
        tabReport.classList.add('hidden');
        tabStatus.classList.remove('hidden');
        btnReport.classList.remove('active');
        btnStatus.classList.add('active');
      }
    }

    /* ==============================================
       ENVIAR TICKET (DO POST)
       ============================================== */
    const ticketForm = document.getElementById('ticketForm');
    const successDiv = document.getElementById('successMessage');

    ticketForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const btn = document.getElementById('submitBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Procesando...';
      btn.disabled = true;

      // Generar fecha y hora local
      const now = new Date();
      document.getElementById('hiddenDate').value = now.toLocaleDateString('es-MX') + ' ' + now.toLocaleTimeString('es-MX');

      // Preparar datos para enviar
      const formObj = new FormData(ticketForm);
      const dataParams = new URLSearchParams();
      for (const pair of formObj) {
          dataParams.append(pair[0], pair[1]);
      }

      // Petición FETCH a Google Script
      fetch(SCRIPT_URL, {
        method: 'POST',
        body: dataParams
      })
      .then(response => response.json())
      .then(data => {
        if (data.result === "success") {
          document.getElementById('newTicketId').innerText = data.id;
          ticketForm.classList.add('hidden');
          successDiv.classList.remove('hidden');
        } else {
          alert("Error del sistema: " + data.error);
        }
        btn.innerHTML = originalText;
        btn.disabled = false;
      })
      .catch(error => {
        console.error(error);
        alert("Hubo un error de conexión. Por favor verifica:\n1. Tu conexión a internet.\n2. Que hayas actualizado el Script a 'Nueva Versión'.");
        btn.innerHTML = originalText;
        btn.disabled = false;
      });
    });

    function resetForm() {
      ticketForm.reset();
      // Restaurar usuario logueado
      const user = document.getElementById('userDisplay').innerText.replace("Usuario: ", "").trim();
      if(user) document.getElementById('incodeHotel').value = user;
      
      successDiv.classList.add('hidden');
      ticketForm.classList.remove('hidden');
    }

    /* ==============================================
       BUSCAR TICKET (DO GET)
       ============================================== */
    function buscarTicket() {
      const idInput = document.getElementById('searchTicketId');
      const id = idInput.value.trim();
      
      if(!id) { alert("Por favor escribe un ID de ticket."); return; }

      const btn = document.getElementById('btnBuscar');
      const originalText = btn.innerHTML;
      const resultBox = document.getElementById('searchResult');
      
      btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Buscando...';
      btn.disabled = true;
      resultBox.classList.add('hidden');

      // Petición GET
      fetch(SCRIPT_URL + "?q=" + encodeURIComponent(id))
      .then(response => response.json())
      .then(data => {
        btn.innerHTML = originalText;
        btn.disabled = false;

        if (data.result === "found") {
          resultBox.classList.remove('hidden');
          
          // Llenar datos
          document.getElementById('resId').innerText = data.data.id;
          document.getElementById('resDate').innerText = "Creado el: " + data.data.fecha;
          document.getElementById('resComments').innerText = data.data.comentarios || "Sin comentarios por el momento.";
          
          // Estilizar Estatus
          const statusEl = document.getElementById('resStatus');
          statusEl.innerText = data.data.estatus;
          statusEl.className = 'status-badge'; // Reset
          
          if (data.data.estatus === 'PENDIENTE') statusEl.classList.add('status-pendiente');
          else if (data.data.estatus === 'CERRADO') statusEl.classList.add('status-cerrado');
          else statusEl.classList.add('status-proceso');
          
        } else {
          alert("No se encontró ningún ticket con el ID: " + id);
        }
      })
      .catch(error => {
        console.error(error);
        btn.innerHTML = originalText;
        btn.disabled = false;
        alert("Error al buscar. Intenta nuevamente.");
      });
    }
  </script>
</body>
</html>